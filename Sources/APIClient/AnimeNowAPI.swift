//
//  AnimeNowAPI.swift
//  
//
//  Created by ErrorErrorError on 12/26/22.
//  
//

import Foundation

public final class AnimeNowAPI: APIBase {
    public static var shared: AnimeNowAPI = .init()
    public let base = URL(string: "https://api.animenow.app")!


    private init() { }
}

// MARK: Keys

extension AnimeNowAPI {
    public static let discordClientKey: String = {
        let encoded: [UInt8] = [
            0x09, 0xae, 0xc4, 0x54, 0xcb,
            0x6c, 0xe6, 0x5a, 0x3d, 0x85,
            0xb1, 0x93, 0x2f, 0x9b, 0x7e,
            0x70, 0xce, 0xfa, 0xae
        ]
        return decode(encoded, cipher: salt)
    }()
}

extension AnimeNowAPI {
    private static let salt: [UInt8] = [
        0x38, 0x9e, 0xf1, 0x6c, 0xfb, 0x54, 0xd2, 0x6f,
        0x0a, 0xbd, 0x84, 0xa3, 0x18, 0xad, 0x4d, 0x46,
        0xf9, 0xcf, 0x98, 0x1b, 0x3f, 0x84, 0xcf, 0x14,
        0xaf, 0x1c, 0x7d, 0x74, 0x4f, 0x96, 0x8f, 0x87,
        0xec, 0xe9, 0x6a, 0xe0, 0x96, 0xa2, 0x44, 0x42,
        0x50, 0xe5, 0xd2, 0x31, 0x0f, 0xa3, 0xbe, 0x95,
        0x6e, 0xea, 0x96, 0xe5, 0x11, 0xc1, 0x50, 0xee,
        0xbe, 0xe6, 0x72, 0xd7, 0x68, 0x5f, 0x6b, 0xa4
    ]

    private static func decode(
        _ encoded: [UInt8],
        cipher: [UInt8]
    ) -> String {
        .init(
            decoding: encoded.enumerated()
                .map { $0.element ^ cipher[$0.offset % cipher.count] },
            as: UTF8.self
        )
    }
}

// Endpoint

public extension Request where Route == AnimeNowAPI {
}
